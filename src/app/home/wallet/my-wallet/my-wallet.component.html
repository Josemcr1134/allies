<div class=" px-4 sm:px-6 lg:px-8 ">
    <header>
        <div class=" mx-auto ">
            <h1 class="text-2xl font-bold leading-tight flex flex-nowrap text-secondary cursor-pointer">
                Mi wallet
            </h1>
        </div>
    </header>
    <ul class="nav nav-tabs flex flex-col md:flex-row flex-wrap list-none border-b-0 pl-0 my-4" id="tabs-tabFill"
      role="tablist">
      <li class="nav-item flex-auto text-center" role="presentation">
        <a href="#tabs-homeFill" class="
          nav-link
          w-full
          block
          font-medium
          text-xs
          leading-tight
          uppercase
          border-x-0 border-t-0 border-b-2 border-transparent
          px-6
          py-3
          my-2
          hover:border-transparent hover:bg-gray-100
          focus:border-transparent
          active
        " id="tabs-home-tabFill" data-bs-toggle="pill" data-bs-target="#tabs-homeFill" role="tab"
          aria-controls="tabs-homeFill" aria-selected="true">Nueva orden</a>
      </li>
      <li class="nav-item flex-auto text-center" role="presentation">
        <a href="#tabs-profileFill" class="
          nav-link
          w-full
          block
          font-medium
          text-xs
          leading-tight
          uppercase
          border-x-0 border-t-0 border-b-2 border-transparent
          px-6
          py-3
          my-2
          hover:border-transparent hover:bg-gray-100
          focus:border-transparent
        " id="tabs-profile-tabFill" data-bs-toggle="pill" data-bs-target="#tabs-profileFill" role="tab"
          aria-controls="tabs-profileFill" aria-selected="false">Ordenes creadas</a>
      </li>
    </ul>
    <div class="tab-content" id="tabs-tabContentFill">
      <div class="tab-pane fade show active" id="tabs-homeFill" role="tabpanel" aria-labelledby="tabs-home-tabFill">
          <div class="grid sm:grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-x-6 gap-y-3">
              <div class="lg:col-span-2 ">
                  <input id="inital-date" [(ngModel)]="start_date" name="inital-date" class="block w-full bg-white border border-gray-300 rounded-md  pl-10 pr-3 text-sm placeholder-gray-500 focus:outline-none focus:text-gray-900 focus:placeholder-gray-400 focus:ring-1  sm:text-sm" placeholder="Buscar..."
                      type="date">
              </div>
              <div class="lg:col-span-2">
                  <input id="final-date" name="final-date" [(ngModel)]="end_date" class="block w-full bg-white border border-gray-300 rounded-md  pl-10 pr-3 text-sm placeholder-gray-500 focus:outline-none focus:text-gray-900 focus:placeholder-gray-400 focus:ring-1  sm:text-sm" placeholder="Buscar..."
                      type="date">
              </div>
              <div class="lg:col-span-1">
                  <button type="button" (click)="GetAttendedAppointmentsByIntervall()" class="min-w-full inline-flex justify-center rounded-md border border-transparent bg-purple-700 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto">
                      Filtrar
                  </button>
              </div>
          </div>
          <div class="mt-8 flex flex-col">
              <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
                  <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
                      <div class="rounded-md bg-yellow-50 p-4" *ngIf="DatesByIntervall.length === 0">
                        <div class="flex">
                          <div class="flex-shrink-0">
                            <!-- Heroicon name: mini/exclamation-triangle -->
                            <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M8.485 3.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 3.495zM10 6a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 6zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                            </svg>
                          </div>
                          <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-800">No encontramos servicios completados</h3>
                            <div class="mt-2 text-sm text-yellow-700">
                              <p>Cambia el rango de fechas para buscar otros resultados</p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg" *ngIf="DatesByIntervall.length">
                          <table class="min-w-full divide-y divide-gray-300">
                              <thead class="bg-gray-50">
                                  <tr>
                                      <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-primary sm:pl-6"></th>
                                      <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-primary sm:pl-6">Afiliado</th>
                                      <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Tipo de consulta </th>
                                      <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Fecha de atenci√≥n</th>
                                      <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Valor consulta</th>
                                      <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Estado</th>

                                  </tr>
                              </thead>
                              <tbody class="divide-y divide-gray-200 bg-white">
                                  <tr *ngFor="let a of DatesByIntervall" class="hover:bg-gray-200 ">
                                    <td class="relative w-12 px-6 sm:w-16 sm:px-8">
                                      <!-- Selected row marker, only show when row is selected. -->
                                      <div class="absolute inset-y-0 left-0 w-0.5 bg-indigo-600"></div>

                                      <input (click)="AddAppointmentToCollect(a.id)" type="checkbox" *ngIf="a.payment_ally === 'Pendiente por cobrar'" class="absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 sm:left-6">
                                    </td>
                                      <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6">
                                          <div class="flex items-center">

                                              <div class="ml-4">
                                                  <div class="font-medium text-gray-900">{{a.user.first_name}} {{a.user.last_name}} </div>
                                              </div>
                                          </div>
                                      </td>
                                      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                          <div class="text-gray-900" *ngIf="a.is_telemedicine === true">Telemedicina</div>
                                          <div class="text-gray-900" *ngIf="a.is_telemedicine === false">Presencial</div>

                                      </td>

                                      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{a.date}}</td>
                                      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{a.ally_fee.fee + a.ally_fee.netcare_fee | currency}} </td>
                                      <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                          <span  [ngClass]="{'bg-green-100': a.payment_ally === 'Pagada','text-green-500': a.payment_ally === 'Pagada', 'text-blue-500': a.payment_ally === 'Cobrada','bg-blue-100': a.payment_ally === 'Cobrada', 'bg-orange-100': a.payment_ally === 'Pendiente por cobrar','text-orange-500': a.payment_ally === 'Pendiente por cobrar', 'text-red-500': a.payment_ally === 'Rechazada', 'bg-red-100': a.payment_ally === 'Rechazada'}"  class="inline-flex rounded-full  px-2 text-xs font-semibold leading-5 ">{{a.payment_ally}}</span>
                                  </tr>

                              </tbody>
                          </table>
                      </div>
                      <nav class="flex items-center justify-between border-t border-gray-200 px-4  my-4 sm:px-0">
                        <div class="-mt-px flex w-0 flex-1">
                          <button type="button" [disabled]="previousIntervall === null" (click)="PaginationByIntervall(-1)" class="disabled:cursor-not-allowed inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">
                            <!-- Heroicon name: mini/arrow-long-left -->
                            <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z" clip-rule="evenodd" />
                            </svg>
                            Anterior
                          </button>
                        </div>

                        <div class="-mt-px flex w-0 flex-1 justify-end">
                          <button type="button" [disabled]="nextIntervall === null" (click)="PaginationByIntervall(1)" class="disabled:cursor-not-allowed inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">
                            Siguiente
                            <!-- Heroicon name: mini/arrow-long-right -->
                            <svg class="ml-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z" clip-rule="evenodd" />
                            </svg>
                          </button>
                        </div>
                      </nav>
                      <div class="flex justify-end ">
                        <button type="button" [disabled]="loading || !appointmentToCollect.length" (click)="NewWalletOrder()" class="disabled:opacity-60 disabled:cursor-not-allowed flex w-full rounded-md border border-transparent btn-primary px-6 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto">
                            Facturar
                        </button>
                    </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="tab-pane fade" id="tabs-profileFill" role="tabpanel" aria-labelledby="tabs-profile-tabFill">
        <div class="px-4 sm:px-6 lg:px-8 mt-12 " >
          <div class="rounded-md bg-yellow-50 p-4" *ngIf="Orders.length === 0">
            <div class="flex">
              <div class="flex-shrink-0">
                <!-- Heroicon name: mini/exclamation-triangle -->
                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M8.485 3.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 3.495zM10 6a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 6zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">Oooops</h3>
                <div class="mt-2 text-sm text-yellow-700">
                  <p>No tienes ordenes de cobro pendientes ni pagadas</p>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 gap-4 sm:grid-cols-1">
              <div *ngFor="let u of Orders" class=" my-2 cursor-pointer rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-lg flex items-center space-x-3 hover:border-purple-400 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-purple-500">
                  <div class="flex justify-between w-full flex-wrap">
                      <a class="focus:outline-none mx-2">
                          <p class="text-sm font-medium text-primary "><span class="text-primary">Aliado: {{u.wallet.slug}}</span></p>
                      </a>
                      <p class="text-sm font-medium text-gray-500 mx-2">Valor: {{u.wallet.balance}}</p>

                      <span  [ngClass]="{'bg-green-100': u.appointment[0].payment_ally === 'Pagada','text-green-500': u.appointment[0].payment_ally === 'Pagada', 'text-blue-500': u.appointment[0].payment_ally === 'Cobrada','bg-blue-100': u.appointment[0].payment_ally === 'Cobrada', 'bg-orange-100': u.appointment[0].payment_ally === 'Pendiente por cobrar','text-orange-500': u.appointment[0].payment_ally === 'Pendiente por cobrar', 'text-red-500': u.appointment[0].payment_ally === 'Rechazada', 'bg-red-100': u.appointment[0].payment_ally === 'Rechazada'}"  class="inline-flex rounded-full  px-2 text-xs font-semibold leading-5 ">{{u.appointment[0].payment_ally}}</span>
                      <p class="text-sm font-medium text-gray-500 mx-2" *ngIf="u.appointment[0].payment_ally === 'Rechazada'"> {{u.reason}}</p>

                      <span class="flex flex-nowrap">
                        <a (click)="GetOrdersCollected(u.appointment)" data-bs-toggle="tooltip" title="Ver citas cobradas" data-bs-toggle="modal" data-bs-target="#exampleModal">
                          <svg   xmlns="http://www.w3.org/2000/svg"  class="h-6 w-6 text-primary cursor-pointer outline-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </a>
                      </span>
                      <a (click)="DeleteOrder(u.id)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-red-500 hover:text-red-600" >
                          <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>

                      </a>
                  </div>
              </div>
          </div>
          <!-- Pagination -->
          <nav class="flex items-center justify-between col-span-4 px-4 mt-3  pb-2 sm:px-0">
              <div class="flex flex-1 w-0 -mt-px">
                  <button type="button" [disabled]="previousOrder === null" (click)="PaginationByOrder(-1)" class="inline-flex items-center pt-4 pr-1 text-sm font-medium text-gray-500 border-t-2 border-transparent cursor-pointer disabled:opacity-60 disabled:cursor-none hover:text-gray-700 hover:border-gray-300">
                      <!-- Heroicon name: solid/arrow-narrow-left -->
                      <svg class="w-5 h-5 mr-3 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                      </svg> Antes
                  </button>
              </div>

              <div class="flex justify-end flex-1 w-0 -mt-px">
                  <button  type="button" [disabled]="nextOrder === null" (click)="PaginationByOrder(1)"  class="inline-flex items-center pt-4 pl-1 text-sm font-medium text-gray-500 border-t-2 border-transparent cursor-pointer disabled:opacity-60 disabled:cursor-none hover:text-gray-700 hover:border-gray-300">
                      Siguiente
                      <!-- Heroicon name: solid/arrow-narrow-right -->
                      <svg class="w-5 h-5 ml-3 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                  </button>
              </div>
          </nav>
      </div>
      </div>

    </div>

</div>


<!-- LOADING SCREEN -->

<div *ngIf="loading" wire:loading class="fixed top-0 left-0 right-0 bottom-0 w-full h-screen z-50 overflow-hidden bg-gray-700 opacity-75 flex flex-col items-center justify-center">
  <div class="loader ease-linear rounded-full border-4 border-t-4 border-cyan-200 h-12 w-12 mb-4"></div>
  <h2 class="text-center text-white text-xl font-semibold">Estamos almacenando el ordenamiento ...</h2>
  <p class="w-1/3 text-center text-white">Esto puede tomar varios segundos, porfavor no cierre ni refresque esta pantalla.</p>
</div>

<!-- Modal Wallet Dates -->
<div class="modal fade fixed top-0 left-0 hidden w-full h-full outline-none overflow-x-hidden overflow-y-auto"
  id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog relative w-auto pointer-events-none">
    <div
      class="modal-content border-none shadow-lg relative flex flex-col w-full pointer-events-auto bg-white bg-clip-padding rounded-md outline-none text-current">
      <div
        class="modal-header flex flex-shrink-0 items-center justify-between p-4 border-b border-gray-200 rounded-t-md">
        <h5 class="text-xl font-medium leading-normal text-gray-800" id="exampleModalLabel">Citas cobradas</h5>
        <button type="button"
          class="btn-close box-content w-4 h-4 p-1 text-black border-none rounded-none opacity-50 focus:shadow-none focus:outline-none focus:opacity-100 hover:text-black hover:opacity-75 hover:no-underline"
          data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body relative p-4">
        <table class="min-w-full divide-y divide-gray-300" >
          <thead class="bg-gray-50">
              <tr>
                  <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-primary sm:pl-6">Afiliado</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Tipo de cita</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Fecha</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-primary">Hora</th>
              </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 bg-white">
              <tr *ngFor="let a of AppointmentsCollected">
                  <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6">
                      <div class="flex items-center">
                          <div class="h-10 w-10 flex-shrink-0">
                            <img *ngIf="a.user.avatar === null" class="h-10 w-10 rounded-full" src="assets/images/favicon.png" alt="">
                            <img *ngIf="a.user.avatar !== null" class="h-10 w-10 rounded-full" [src]="a.medical_specialty.medical.avatar" alt="">
                          </div>
                          <div class="ml-4">
                              <div class="font-medium text-gray-900">{{a.user.first_name}} {{a.user.last_name}}</div>
                          </div>
                      </div>
                  </td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-900">
                      <span *ngIf="a.is_telemedicine" class="text-gray-900">Telemedicina</span>
                      <span *ngIf="!a.is_telemedicine" class="text-gray-900">Presencial</span>

                  </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-900 ">{{a.date}} </td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-900 ">{{a.start_time}} - {{a.end_time}}</td>

              </tr>
              <!-- -->
          </tbody>
      </table>
      </div>
      <div
        class="modal-footer flex flex-shrink-0 flex-wrap items-center justify-end p-4 border-t border-gray-200 rounded-b-md">
        <button type="button" class="px-6
          py-2.5
          bg-cyan-600
          text-white
          font-medium
          text-xs
          leading-tight
          uppercase
          rounded
          shadow-md
          hover:bg-cyan-700 hover:shadow-lg
          focus:bg-cyan-700 focus:shadow-lg focus:outline-none focus:ring-0
          active:bg-cyan-800 active:shadow-lg
          transition
          duration-150
          ease-in-out" data-bs-dismiss="modal">Cerrar</button>

      </div>
    </div>
  </div>
</div>

<!-- Required popper.js TOOLTIP-->
<script src="https://unpkg.com/@popperjs/core@2.9.1/dist/umd/popper.min.js" charset="utf-8"></script>
<script type="text/javascript">
  var tooltipTriggerList = [].slice.call(
    document.querySelectorAll('[data-bs-toggle="tooltip"]')
  );
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new Tooltip(tooltipTriggerEl);
  });
</script>
